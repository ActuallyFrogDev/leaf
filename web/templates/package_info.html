<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>leaf: {{ manifest.name or filename }}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/logo.png') }}"
      type="image/png"
    />
    <script
      src="{{ url_for('static', filename='javascript/script.js') }}"
      defer
    ></script>
  </head>
  <body class="bg">
    <header class="site-header">
      <div class="container">
        <a href="/" class="brand">
          <img
            src="{{ url_for('static', filename='images/logo.png') }}"
            alt="leaf logo"
            class="logo"
          />leaf
        </a>
        <nav class="nav">
          <a href="/" class="nav-link">Home</a>
          <a href="{{ url_for('packages') }}" class="nav-link">Packages</a>
          <form
            action="{{ url_for('search') }}"
            method="GET"
            class="nav-search"
          >
            <input type="text" name="q" placeholder="Search..." />
          </form>
          <a href="/upload" class="nav-link primary-nav">Upload</a>
          {% if session.get('role') in ['admin','owner'] %}
          <a href="{{ url_for('admin_review') }}" class="nav-link">Review</a>
          {% endif %} {% if session.get('user') %}
          <a
            href="{{ url_for('user_profile', username=session.get('user')) }}"
            class="nav-link nameplate"
            title="View profile"
          >
            {% if current_avatar_url %}
            <img src="{{ current_avatar_url }}" alt="avatar" class="pfp" />
            {% endif %}
            <span class="name">Hi, {{ session.get('user') }}</span>
            {% if session.get('role') in ['admin','owner'] %}
            <span class="badge">{{ session.get('role')|capitalize }}</span>
            {% endif %}
          </a>
          <a href="{{ url_for('logout') }}" class="nav-link">Logout</a>
          {% else %}
          <a href="{{ url_for('login') }}" class="nav-link">Login</a>
          <a href="{{ url_for('signup') }}" class="nav-link">Sign Up</a>
          {% endif %}
        </nav>
      </div>
    </header>

    <main class="container">
      <section class="form-card fancy-card fade-in">
        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
          <div style="width: 64px; height: 64px; border-radius: 12px; background: linear-gradient(135deg, rgba(34, 193, 195, 0.2), rgba(59, 130, 246, 0.2)); display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 32px;">ðŸ“¦</span>
          </div>
          <div>
            <h2 style="margin: 0;">{{ manifest.name or filename.rsplit('.', 1)[0] }}</h2>
            {% if manifest.version %}
            <span class="muted" style="font-size: 0.9em;">v{{ manifest.version }}</span>
            {% endif %}
          </div>
        </div>

        {% if manifest.description %}
        <p style="margin-bottom: 20px; color: var(--muted);">{{ manifest.description }}</p>
        {% endif %}

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
          <div>
            <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">Author</h4>
            <div class="muted">
              {% if manifest.author %}
              {{ manifest.author }}
              {% else %}
              <a href="{{ url_for('user_profile', username=username) }}" style="color: var(--muted);">{{ username }}</a>
              {% endif %}
            </div>
          </div>

          {% if manifest.license %}
          <div>
            <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">License</h4>
            <div class="muted">{{ manifest.license }}</div>
          </div>
          {% endif %}

          <div>
            <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">File Size</h4>
            <div class="muted">
              {% if filesize < 1024 %}
              {{ filesize }} B
              {% elif filesize < 1048576 %}
              {{ (filesize / 1024)|round(1) }} KB
              {% else %}
              {{ (filesize / 1048576)|round(2) }} MB
              {% endif %}
            </div>
          </div>

          <div>
            <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">Uploaded By</h4>
            <div class="muted">
              <a href="{{ url_for('user_profile', username=username) }}" style="color: var(--muted);">{{ username }}</a>
            </div>
          </div>
        </div>

        {% if manifest.homepage or manifest.repository %}
        <div style="margin-bottom: 24px;">
          <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">Links</h4>
          <div style="display: flex; gap: 16px;">
            {% if manifest.homepage %}
            <a href="{{ manifest.homepage }}" target="_blank" rel="noopener" style="color: var(--card);">Homepage</a>
            {% endif %}
            {% if manifest.repository %}
            <a href="{{ manifest.repository }}" target="_blank" rel="noopener" style="color: var(--card);">Repository</a>
            {% endif %}
          </div>
        </div>
        {% endif %}

        {% if manifest.dependencies %}
        <div style="margin-bottom: 24px;">
          <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">Dependencies</h4>
          <ul style="list-style: none; padding: 0; margin: 0;">
            {% for dep in manifest.dependencies %}
            <li class="muted" style="padding: 4px 0;">{{ dep }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if manifest.files %}
        <div style="margin-bottom: 24px;">
          <h4 style="margin: 0 0 8px 0; font-size: 0.85em; text-transform: uppercase; letter-spacing: 0.5px;">Files ({{ manifest.files|length }})</h4>
          <ul style="list-style: none; padding: 0; margin: 0; max-height: 200px; overflow-y: auto;">
            {% for file in manifest.files %}
            <li class="muted" style="padding: 4px 0; font-family: monospace; font-size: 0.9em;">{{ file }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        <div style="display: flex; gap: 12px; padding-top: 16px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
          <a href="{{ url_for('user_file_download', username=username, filename=filename) }}" class="btn primary">
            Download Package
          </a>
          <a href="{{ url_for('packages') }}" class="btn ghost">
            Back to Packages
          </a>
        </div>
      </section>

      {% if manifest.raw %}
      <section class="ide-card fancy-card fade-in" style="margin-top: 24px;">
        <div class="ide-toolbar">
          <div class="ide-tabs">
            <span class="tab active">{{ filename }}</span>
          </div>
        </div>
        <div class="ide">
          <div class="line-numbers" aria-hidden></div>
          <div class="editor" contenteditable="false">
            <pre><code>{{ manifest.raw|e }}</code></pre>
          </div>
        </div>
      </section>
      {% endif %}
    </main>
  </body>
</html>
